<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>NEON PONG XTREME - Ultimate Arena Battle</title>
    <style>
        body { 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background: linear-gradient(45deg, #000, #0a0a2e, #1a0033); 
            font-family: 'Courier New', monospace; 
            color: #00ff88;
            overflow: hidden;
        }
        #gameContainer {
            position: relative;
            border: 3px solid #00ff88;
            border-radius: 10px;
            box-shadow: 0 0 50px #00ff88;
        }
        canvas { 
            background: #000; 
            border-radius: 7px;
            display: block;
        }
        #uiOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        #settingsPanel, #mainMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,20,40,0.95);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 30px;
            pointer-events: all;
            box-shadow: 0 0 30px #00ff88;
            min-width: 350px;
            display: none;
        }
        #mainMenu { display: block; }
        h1 { margin: 0 0 20px; text-align: center; font-size: 28px; text-shadow: 0 0 10px #00ff88; }
        button, input, select {
            width: 100%; margin: 10px 0; padding: 12px;
            background: rgba(0,255,136,0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
            font-family: inherit;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover, input:focus, select:focus {
            background: rgba(0,255,136,0.4);
            box-shadow: 0 0 15px #00ff88;
            outline: none;
        }
        label { display: block; margin: 15px 0 5px; font-size: 14px; }
        #xpBar {
            width: 100%; height: 20px; background: rgba(0,0,0,0.5); border: 1px solid #00ff88; border-radius: 10px; overflow: hidden;
        }
        #xpFill { height: 100%; background: linear-gradient(90deg, #ffaa00, #00ff88); width: 0%; transition: width 0.5s; }
        .ability { margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; }
        .unlocked { background: rgba(0,255,136,0.3); }
        #instructions {
            position: absolute; top: 10px; right: 10px; color: #00ff88; font-size: 12px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; max-width: 200px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="pong" width="800" height="600"></canvas>
        <div id="uiOverlay">
            <div id="mainMenu">
                <h1>üåü NEON PONG XTREME üåü</h1>
                <p style="text-align: center; margin-bottom: 20px;">Ultimate Arena Battle - Sblocca poteri epici!</p>
                <button onclick="showSettings()">‚öôÔ∏è Impostazioni</button>
                <select id="difficultySelect" onchange="setDifficulty()">
                    <option value="easy">ü•â Facile</option>
                    <option value="normal" selected>‚ö° Normale</option>
                    <option value="hard">üî• Difficile</option>
                    <option value="xtreme">üíÄ Xtreme</option>
                </select>
                <button onclick="startGame()">üöÄ Inizia Partita</button>
            </div>
            <div id="settingsPanel">
                <h2>‚öôÔ∏è Impostazioni</h2>
                <label>Volume Suoni: <span id="volumeValue">50</span>%</label>
                <input type="range" id="volumeSlider" min="0" max="100" value="50" onchange="setVolume()">
                <label>Qualit√† Grafica:</label>
                <select id="graphicsQuality" onchange="setGraphics()">
                    <option value="low">Bassa</option>
                    <option value="medium" selected>Media</option>
                    <option value="high">Alta</option>
                </select>
                <label>Sensibilit√† Paddle: <span id="sensitivityValue">1.0</span>x</label>
                <input type="range" id="sensitivitySlider" min="0.5" max="2" step="0.1" value="1" onchange="setSensitivity()">
                <button onclick="showMainMenu()">‚Üê Torna Menu</button>
            </div>
            <div id="instructions">
                ESC: Menu | P: Pausa | R: Reset<br>
                XP: <div id="xpBar"><div id="xpFill"></div></div> Lv.<span id="level">1</span>
                <div id="abilities">
                    <div class="ability locked">üöÄ Velocit√† +20% (Lv.2)</div>
                    <div class="ability locked">üõ°Ô∏è Big Paddle (Lv.5)</div>
                    <div class="ability locked">‚ö° PowerUp Random (Lv.10)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio per effetti -->
    <audio id="hitSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcDje9d+8fC3ww=" type="audio/wav">
    </audio>
    <audio id="scoreSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRp4GAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcDje9d+8fC3ww=" type="audio/wav">
    </audio>

    <script>
        // Inizializza variabili globali
        let game = null;
        let audioCtx = null;
        let gameState = 'menu'; // menu, playing, paused
        let settings = {
            volume: 0.5,
            graphics: 'medium',
            sensitivity: 1.0,
            difficulty: 'normal'
        };
        let playerData = {
            xp: 0,
            level: 1,
            abilities: { speedBoost: false, bigPaddle: false, powerUp: false }
        };

        // Funzioni UI
        function showSettings() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('settingsPanel').style.display = 'block';
        }

        function showMainMenu() {
            document.getElementById('settingsPanel').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
            gameState = 'menu';
        }

        function setVolume() {
            settings.volume = document.getElementById('volumeSlider').value / 100;
            document.getElementById('volumeValue').textContent = Math.round(settings.volume * 100);
        }

        function setGraphics() {
            settings.graphics = document.getElementById('graphicsQuality').value;
        }

        function setSensitivity() {
            settings.sensitivity = parseFloat(document.getElementById('sensitivitySlider').value);
            document.getElementById('sensitivityValue').textContent = settings.sensitivity.toFixed(1);
        }

        function setDifficulty() {
            settings.difficulty = document.getElementById('difficultySelect').value;
            // Applica modificatori
            updateDifficultyModifiers();
        }

        function startGame() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('settingsPanel').style.display = 'none';
            gameState = 'playing';
            initGame();
        }

        function updateDifficultyModifiers() {
            const mods = { easy: 0.7, normal: 1, hard: 1.3, xtreme: 1.6 };
            CONSTANTS.BALL_SPEED_X *= mods[settings.difficulty] / (CONSTANTS.BALL_SPEED_X > 0 ? 1 : 1);
            // Applica ad altre costanti similmente
        }

        // Inizializza AudioContext per suoni migliori
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            if (settings.volume === 0) return;
            const audio = document.getElementById(type === 'hit' ? 'hitSound' : 'scoreSound');
            audio.volume = settings.volume;
            audio.currentTime = 0;
            audio.play().catch(() => {});
        }

        // Aggiorna XP e abilit√†
        function addXP(amount) {
            playerData.xp += amount;
            const newLevel = Math.floor(playerData.xp / 100) + 1;
            if (newLevel > playerData.level) {
                playerData.level = newLevel;
                unlockAbilities();
            }
            updateXPUI();
        }

        function unlockAbilities() {
            if (playerData.level >= 2) playerData.abilities.speedBoost = true;
            if (playerData.level >= 5) playerData.abilities.bigPaddle = true;
            if (playerData.level >= 10) playerData.abilities.powerUp = true;
            updateAbilitiesUI();
        }

        function updateXPUI() {
            const progress = (playerData.xp % 100);
            document.getElementById('xpFill').style.width = progress + '%';
            document.getElementById('level').textContent = playerData.level;
        }

        function updateAbilitiesUI() {
            const abils = document.querySelectorAll('.ability');
            abils[0].classList.toggle('unlocked', playerData.abilities.speedBoost);
            abils[1].classList.toggle('unlocked', playerData.abilities.bigPaddle);
            abils[2].classList.toggle('unlocked', playerData.abilities.powerUp);
        }

        // Costanti aggiornate
        const CONSTANTS = {
            PADDLE_HEIGHT: 80,
            PADDLE_WIDTH: 10,
            BALL_SIZE: 10,
            BALL_SPEED_X: 5,
            BALL_SPEED_Y: 3,
            PADDLE_SPEED: 20
        };

        // Classi Game, Paddle, Ball (come prima, con aggiunte)
        class Game {
            // ... (stesso codice precedente, con aggiunte sotto)

            constructor(canvas) {
                // ... init precedente
                this.powerUps = [];
                this.useAbility(effect) {
                    if (playerData.abilities[effect]) {
                        // Applica effetto temporaneo
                        addXP(10);
                    }
                }
            }

            update() {
                if (gameState !== 'playing' || this.paused) return;
                // ... update precedente
                this.updatePowerUps();
                if (playerData.abilities.speedBoost) this.ball.speedX *= 1.2; // Esempio
            }

            // Aggiungi metodi per powerup, grafica high quality (particelle, glow), etc.
            updateGraphics() {
                if (settings.graphics === 'high') {
                    // Aggiungi glow effects con shadow
                    this.ctx.shadowColor = '#00ff88';
                    this.ctx.shadowBlur = 20;
                } else {
                    this.ctx.shadowBlur = 0;
                }
            }

            checkScoring() {
                // ... precedente
                addXP(5); // Guadagna XP su punto
                playSound('score');
            }
        }

        // Inizializza gioco
        function initGame() {
            const canvas = document.getElementById('pong');
            canvas.height = 600;
            game = new Game(canvas);
            initAudio();
            updateXPUI();
            updateAbilitiesUI();
            game.gameLoop();
        }

        // Controlli globali
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                gameState = gameState === 'playing' ? 'paused' : 'playing';
                document.getElementById('mainMenu').style.display = gameState === 'menu' ? 'block' : 'none';
            }
            // ... keys precedente
        });

        // Applica sensibilit√†
        // Nel movimento paddle: PADDLE_SPEED * settings.sensitivity
    </script>
</body>
</html>
